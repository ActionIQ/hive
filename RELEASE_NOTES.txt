Release Notes - Hive - Version 4.0.0-alpha-2

** Sub-task
    * [HIVE-22417] - Remove stringifyException from MetaStore
    * [HIVE-23745] - Avoid copying userpayload in task communicator
    * [HIVE-25091] - Implement connector provider for MSSQL and Oracle
    * [HIVE-25540] - Enable batch update of column stats only for MySql and Postgres 
    * [HIVE-25921] - Overwrite table metadata for bootstraped tables
    * [HIVE-26171] - HMSHandler get_all_tables method can not retrieve tables from remote database
    * [HIVE-26223] - Integrate ESRI GeoSpatial UDFs 
    * [HIVE-26224] - Add support for ESRI GeoSpatial SERDE formats
    * [HIVE-26240] - Add tests for Esri UDFs for Geospatial
    * [HIVE-26278] - Add unit tests for Hive#getPartitionsByNames using batching
    * [HIVE-26279] - Drop unused requests from TestHiveMetaStoreClientApiArgumentsChecker
    * [HIVE-26488] - Fix NPE in DDLSemanticAnalyzerFactory during compilation
    * [HIVE-26512] - ST_GeometryProcessing is incorrectly registered as function
    * [HIVE-26541] - WebHCatServer start fails with NPE
    * [HIVE-26549] - WebHCat servers fails to start due to authentication filter configuration



** Bug
    * [HIVE-25758] - OOM due to recursive application of CBO rules
    * [HIVE-25879] - MetaStoreDirectSql test query should not query the whole DBS table
    * [HIVE-25976] - Cleaner may remove files being accessed from a fetch-task-converted reader
    * [HIVE-25993] - Query-based compaction doesn't work when partition column type is boolean
    * [HIVE-26074] - PTF Vectorization: BoundaryScanner for varchar
    * [HIVE-26096] - Select on single column MultiDelimitSerDe table throws AIOBE
    * [HIVE-26112] - Missing scripts for metastore
    * [HIVE-26113] - Align HMS and metastore tables's schema
    * [HIVE-26114] - Fix jdbc connection hiveserver2 using dfs command with prefix space will cause exception
    * [HIVE-26127] - INSERT OVERWRITE throws FileNotFound when destination partition is deleted 
    * [HIVE-26130] - Incorrect matching of external table when validating NOT NULL constraints
    * [HIVE-26131] - Incorrect OutputFormat when describing jdbc connector table 
    * [HIVE-26135] - Invalid Anti join conversion may cause missing results
    * [HIVE-26139] - URL Encoding from HIVE-26015 was a bit too aggressive
    * [HIVE-26141] - Fix vector_ptf_part_simple_all_datatypes source file
    * [HIVE-26147] - OrcRawRecordMerger throws NPE when hive.acid.key.index is missing for an acid file
    * [HIVE-26158] - TRANSLATED_TO_EXTERNAL partition tables cannot query partition data after rename table
    * [HIVE-26180] - Change MySQLConnectorProvider driver from mariadb to mysql
    * [HIVE-26184] - COLLECT_SET with GROUP BY is very slow when some keys are highly skewed
    * [HIVE-26192] - JDBC data connector queries  occur exception at cbo stage
    * [HIVE-26197] - Hive - Upgrade Ant to 1.10.11 due to CVE-2021-36373 and CVE-2021-36374
    * [HIVE-26205] - Remove the incorrect org.slf4j dependency in kafka-handler
    * [HIVE-26210] - Fix tests for Cleaner failed attempt threshold
    * [HIVE-26231] - Generate insert notification events when dynamic partition insert is done on existing partitions
    * [HIVE-26259] - Alter Function does not update resource uris
    * [HIVE-26266] - Column information is not present in lineage for CTAS when custom location/translated location is used
    * [HIVE-26267] - Addendum to HIVE-26107: perpared statement is not working on Postgres
    * [HIVE-26268] - Upgrade snappy-java to 1.1.8.4
    * [HIVE-26270] - Wrong timestamps when reading Hive 3.1.x Parquet files with vectorized reader
    * [HIVE-26277] - NPEs and rounding issues in ColumnStatsAggregator classes
    * [HIVE-26288] - NPE in CompactionTxnHandler.markFailed()
    * [HIVE-26296] - RuntimeException when executing EXPLAIN CBO JOINCOST on query with JDBC tables
    * [HIVE-26300] - Upgrade Jackson databind version to 2.12.6.1+ to avoid CVE-2020-36518
    * [HIVE-26320] - Incorrect results for IN UDF on Parquet column of CHAR/VARCHAR type
    * [HIVE-26349] - TestOperatorCmp/TestReOptimization fail silently due to incompatible configuration
    * [HIVE-26350] - IndexOutOfBoundsException when generating splits for external JDBC table with partition columns
    * [HIVE-26352] - Tez queue access check fails with GSS Exception on Compaction
    * [HIVE-26355] - Column compare should be case insensitive for name
    * [HIVE-26366] - PTF Vectorization: BoundaryScanner for boolean
    * [HIVE-26373] - ClassCastException when reading timestamps from HBase table with Avro data
    * [HIVE-26374] - Query based compaction fails for tables with CDT and columns with Reserved Keywords
    * [HIVE-26386] - Exceptions thrown in ObjectStore should contain all causes
    * [HIVE-26388] - ClassCastException when there is non string type column in source table of CTAS query
    * [HIVE-26396] - The trunc function has a problem with precision interception and the result has many 0
    * [HIVE-26404] - HMS memory leak when compaction cleaner fails to remove obsolete files
    * [HIVE-26408] - Vectorization: Fix deallocation of scratch columns, don't reuse a child ConstantVectorExpression as an output
    * [HIVE-26409] - Assign NO_TXN operation type for table in global locks for scheduled queries
    * [HIVE-26423] - Make commons-pool2 an explicit dependency (and upgrade to 2.11.1)
    * [HIVE-26426] - Avoid StringIndexOutOfBoundsException in canCBOHandleAst() method.
    * [HIVE-26438] - Remove unnecessary optimization in canHandleQbForCbo() method
    * [HIVE-26440] - Duplicate hive-standalone-metastore-server dependency in QFile module
    * [HIVE-26446] - HiveProtoLoggingHook fails to populate TablesWritten field for partitioned tables.
    * [HIVE-26466] - NullPointerException on HiveQueryLifeTimeHook:checkAndRollbackCTAS
    * [HIVE-26468] - Cleanup dependency to FlatBuffers
    * [HIVE-26481] - Cleaner fails with FileNotFoundException
    * [HIVE-26495] - MSCK repair perf issue HMSChecker ThreadPool is blocked at fs.listStatus
    * [HIVE-26496] - FetchOperator scans delete_delta folders multiple times causing slowness
    * [HIVE-26504] - User is not able to drop table
    * [HIVE-26510] - Minor compaction creates empty delta files when no prior delta file exists
    * [HIVE-26511] - Fix NoClassDefFoundError in HMS for HBaseConfiguration
    * [HIVE-26556] - Iceberg: Properties set in HiveIcebergSerde are not propagated to jobconf
    * [HIVE-26584] - compressed_skip_header_footer_aggr.q is flaky
    * [HIVE-26608] - Iceberg: Allow parquet write properties to iceberg via session conf and Table Properties
    * [HIVE-26614] - Fix adding custom jars in Job Classpath
    * [HIVE-26616] - Spark 3.3.0 doesn't works with Hive 3.1.2
    * [HIVE-26639] - ConstantVectorExpression and ExplainTask shouldn't rely on default charset
    * [HIVE-26643] - HiveUnionPullUpConstantsRule produces an invalid plan when pulling up constants for nullable fields


** New Feature
    * [HIVE-25230] - add position and occurrence to instr()
    * [HIVE-25826] - Support table defaults at each database level
    * [HIVE-26015] - CREATE HBase table fails when SERDEPROPERTIES contain special characters
    * [HIVE-26425] - Skip SSL cert verification for downloading JWKS in HS2
    * [HIVE-26443] - Add priority queueing to compaction
    * [HIVE-26524] - Use Calcite to remove sections of a query plan known never produces rows
    * [HIVE-26551] - Support CREATE TABLE LIKE FILE for ORC
    * [HIVE-26555] - Read-only mode for Hive database


** Improvement
    * [HIVE-14514] - OrcRecordUpdater should clone writerOptions when creating delete event writers
    * [HIVE-22193] - Graceful Shutdown HiveServer2
    * [HIVE-24483] - aarch64 Support: Bump protobuf version to 3.21.4
    * [HIVE-24484] - Upgrade Hadoop to 3.3.1 And Tez to 0.10.2 
    * [HIVE-25635] - Upgrade Thrift to 0.16.0
    * [HIVE-25872] - Skip tracking of alterDatabase events for replication specific properties.
    * [HIVE-26020] - Set dependency scope for json-path, commons-compiler and janino to runtime
    * [HIVE-26021] - Change integration tests under DBInstallBase to CheckIn tests
    * [HIVE-26026] - Use the new "REFUSED" compaction state where it makes sense
    * [HIVE-26058] - Choose meaningful names for the Metastore pool threads
    * [HIVE-26059] - Eventually clean compactions in "refused" state from compaction history
    * [HIVE-26107] - Worker shouldn't inject duplicate entries in `ready for cleaning` state into the compaction queue
    * [HIVE-26119] - Remove unnecessary Exceptions from DDLPlanUtils
    * [HIVE-26122] - Factorize out common docker code between DatabaseRule and AbstractExternalDB
    * [HIVE-26146] - Handle missing hive.acid.key.index in the fixacidkeyindex utility
    * [HIVE-26148] - Keep MetaStoreFilterHook interface compatibility after introducing catalogs
    * [HIVE-26170] - Code cleanup in jdbc dataconnector
    * [HIVE-26172] - Upgrade ant to 1.10.12
    * [HIVE-26173] - Upgrade derby to 10.14.2.0
    * [HIVE-26182] - Some improvements to make DPP more debuggable
    * [HIVE-26195] - Keep Kafka handler naming style consistent with others
    * [HIVE-26196] - Integrate Sonar analysis for the master branch and PRs
    * [HIVE-26215] -  Expose the MIN_HISTORY_LEVEL table  through Hive sys database 
    * [HIVE-26217] - Make CTAS use Direct Insert Semantics
    * [HIVE-26226] - Exclude jdk.tools dep from hive-metastore in upgrade-acid
    * [HIVE-26238] - Decouple sort filter predicates optimization from digest normalization in CBO
    * [HIVE-26242] - Compaction heartbeater improvements
    * [HIVE-26260] - Use `Reader.getSchema` instead of deprecated `Reader.getTypes`
    * [HIVE-26272] - Inline util code that is used from log4j jar
    * [HIVE-26280] - Copy more data into COMPLETED_COMPACTIONS for better supportability
    * [HIVE-26294] - Allow substr to take bigint as parameters
    * [HIVE-26322] - Upgrade gson to 2.9.0
    * [HIVE-26367] -  Upgrade to tez 0.10.2
    * [HIVE-26378] - Improve error message for masking over complex data types
    * [HIVE-26381] - Fix link in Javadoc of MetaStoreUtils::getCurrentClassPaths
    * [HIVE-26401] - Refine the log of add_partitions if the partition already exists
    * [HIVE-26402] - HiveSchemaTool does not honor metastore-site.xml
    * [HIVE-26414] - Aborted/Cancelled CTAS operations must initiate cleanup of uncommitted data
    * [HIVE-26429] - Set default value of hive.txn.xlock.ctas to true and update lineage info for CTAS queries.
    * [HIVE-26439] - Skip collecting Kafka delegation tokens if PLAINTEXT is set
    * [HIVE-26444] - Use tez.local.mode.without.network for unit tests
    * [HIVE-26450] - Use a more lightweight Oracle image
    * [HIVE-26459] - ReduceRecordProcessor: move to using a timeout version of waitForAllInputsReady(TEZ-3302)
    * [HIVE-26471] - New metric for Compaction pooling
    * [HIVE-26474] - Enable converting insert-only tables to full ACID tables
    * [HIVE-26479] - Add ability to set parameters for query-based compaction
    * [HIVE-26480] - Improve SYS.COMPACTIONS and SYS.TRANSACTIONS views
    * [HIVE-26500] - Improve TestHiveMetastore
    * [HIVE-26519] - Iceberg: Add support for CTLT queries
    * [HIVE-26529] - Iceberg: Fix VectorizedSupport support for DECIMAL_64 in HiveIcebergInputFormat.
    * [HIVE-26532] - Remove logger from critical path in VectorMapJoinInnerLongOperator::processBatch
    * [HIVE-26535] - Iceberg: Support adding parquet compression type via Table properties
    * [HIVE-26536] - Enable 'hive.acid.truncate.usebase' by default
    * [HIVE-26543] - Improve TxnHandler, TxnUtils, CompactionTxnHandler logging
    * [HIVE-26563] - Add extra columns in Show Compactions output and sort the output
    * [HIVE-26564] - Separate query live operation log and historical operation log
    * [HIVE-26603] - Initiator does not initiate minor compaction for insert-only tables
    * [HIVE-26613] - Upgrade jettison to 1.5.1 to fix CVE-2022-40149
    * [HIVE-26618] - Add setting to turn on/off removing sections of a query plan known never produces rows
    * [HIVE-26620] - Remove unused imports for ThriftBinaryCLIService class
    * [HIVE-26623] - Maintain same columns in COMPACTIONS view present in SYS and INFORMATION_SCHEMA
    * [HIVE-26638] - Replace in-house CBO reduce expressions rules with Calcite's built-in classes
    * [HIVE-26642] - Replace HiveFilterMergeRule with Calcite's built-in implementation

** Test
    * [HIVE-26123] - Introduce test coverage for sysdb for the different metastores
    * [HIVE-26461] - Add CI build check for macOS
    * [HIVE-26494] - Fix flaky test TestJdbcWithMiniHS2 testHttpRetryOnServerIdleTimeout
    * [HIVE-26619] - Sonar analysis is not run for the master branch


** Task
    * [HIVE-23744] - Reduce query startup latency
    * [HIVE-26019] - Upgrade com.jayway.jsonpath from 2.4.0 to 2.7.0
    * [HIVE-26023] - Non blocking REPLACE, RENAME COLUMNS
    * [HIVE-26051] - Non blocking ALTER MATERIALIZED VIEW REWRITE
    * [HIVE-26052] - Non blocking DROP MATERIALIZED VIEW implementation
    * [HIVE-26053] - Non blocking DROP VIEW
    * [HIVE-26062] - Make sure that running 4.0.0-alpha-2 above 4.0.0-alpha-1 HMS DB reports the correct error
    * [HIVE-26067] - Remove core directory from src
    * [HIVE-26068] - Add README with build instructions to the src tarball 
    * [HIVE-26076] - Non blocking ADD PARTITION if not exists
    * [HIVE-26092] - Fix javadoc errors for the 4.0.0 release
    * [HIVE-26106] - Non blocking ADD, DROP constraint
    * [HIVE-26121] - Hive transaction rollback should be thread-safe
    * [HIVE-26129] - Non blocking DROP CONNECTOR
    * [HIVE-26149] - Non blocking DROP DATABASE implementation
    * [HIVE-26165] - Remove READ locks for ACID tables
    * [HIVE-26227] - Add support of catalog related statements for Hive ql
    * [HIVE-26252] - Missing locks in case of MERGE with multiple branches
    * [HIVE-26289] - Remove useless try catch in DataWritableReadSupport#getWriterDateProleptic
    * [HIVE-26290] - Remove useless calls to DateTimeFormatter#withZone without assignment
    * [HIVE-26293] - Migrate remaining exclusive DDL operations to EXCL_WRITE lock & bug fixes
    * [HIVE-26309] - Remove Log4jConfig junit extension in favor LoggerContextSource
    * [HIVE-26310] - Remove unused junit runners from test-utils module
    * [HIVE-26314] - Support alter function in Hive DDL
    * [HIVE-26324] - Add "one-row-table" constraints on NOTIFICATION_SEQUENCE table
    * [HIVE-26331] - Use maven-surefire-plugin version consistently in standalone-metastore modules
    * [HIVE-26416] - AcidUtils$MetaDataFile.isRawFormatFile() throws InvalidProtocolBufferException for non-ORC file
    * [HIVE-26433] - StorageHandler authorization doesn't work with "METASTORE" db type
    * [HIVE-26458] - Add explicit dependency to commons-dbcp2 in hive-exec module
    * [HIVE-26487] - Auto-compaction may hang or skip some of the eligible items 
    * [HIVE-26579] - Prepare for Hadoop and Zookeeper switching to Reload4j
    * [HIVE-26626] - Cut dependencies between HiveXxPullUpConstantsRule and HiveReduceExpressionsRule
    * [HIVE-26627] - Remove HiveRelBuilder.aggregateCall override and refactor callers to use existing public methods